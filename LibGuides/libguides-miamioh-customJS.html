<!--
JS Last Updated 2021-06-11
Updated by: Jerry Yarnetsky 
-->

<!-- from Github/LibApps-Customizations -->

<!-- <link href="https://cdn.jsdelivr.net/gh/Miamiohlibs/LibApps-Customizations@main/bs5test/libguides-miamioh-custom.css" rel="stylesheet" /> 
<link href="https://cdn.jsdelivr.net/gh/Miamiohlibs/LibApps-Customizations@main/bs5test/side-nav.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/gh/Miamiohlibs/LibApps-Customizations@main/bs5test/libguides-miamioh-custom.js" type="text/javascript"></script>  -->

<!-- JS from LIB.MIAMIOH  -->

<script src="https://demo.lib.miamioh.edu/assets/js/simple-key-nav.js" type="text/javascript"></script>
<script src="https://www.lib.miamioh.edu/assets/js/modernizr.custom.js" type="text/javascript"></script>
<script src="https://www.lib.miamioh.edu/assets/js/aria-expanded.js" type="text/javascript"></script>

<!-- BOOTSTRAP -->

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
    crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css">

<!-- Google Custom Search -->
<script src="https://www.google.com/cse/static/element/323d4b81541ddb5b/cse_element__en.js?usqp=CAI%3D" type="text/javascript"></script>
<link type="text/css" rel="stylesheet" href="https://www.google.com/cse/static/element/323d4b81541ddb5b/default+en.css">
<link type="text/css" rel="stylesheet" href="https://www.google.com/cse/static/style/look/v4/default.css"> 

<!-- FONTS AND ICON-->

<link href="https://fonts.googleapis.com/css?family=Cabin+Condensed&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Raleway:200,300&display=swap" rel="stylesheet">
<link rel="shortcut icon" href="https://www.lib.miamioh.edu/sites/default/files/favicon_0.ico" />

<script>
/** ----------------------------------------------------------------
 * Table of Contents (Javascript):
 * 0.1 - AppendEmail
 * 0.2 - Google Custom Search
 * 0.3 - Add aria-current="page" in main menu
 * 1.0 & Beyond -- CSS (see below for detailed CSS TOC)
 * -------------------------------------------------------------------
 */

/* 
 *   0.1 - Append Email
 *   this function can be called from the "other widget code" section
 *   to append a users email address to the contact box (in addition to
 *   the "Email Me" button)
 */
    const AppendEmail = (profileId) => { 
        let thisProfile = $('#s-lib-profile-' + profileId);
        let emailAddress = $(thisProfile)
            .find('.s-lib-profile-email a')
            .attr('title');
        let emailDiv = '<div>' + emailAddress + '</div>';
        let websiteLogo = $(thisProfile).find(
            '.s-lib-profile-contact a .fa-bookmark'
        );
        let skypeLogo = $(thisProfile).find('.s-lib-profile-contact a .fa-skype');
        if (websiteLogo.length > 0) {
            $(websiteLogo).parent().before(emailDiv);
        } else if (skypeLogo.length > 0) {
            $(skypeLogo).parent().before(emailDiv);
        } else {
            $(thisProfile).find('.s-lib-profile-contact').append(emailDiv);
        }
    }

   /* 
     * 0.2 - Google Custom Search
     * adds Google Custom Search box to header 
     */

    $(function () {
      var cx = '009740610740149956689:vgajvsbmghf';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);

      // Enlarge the magnify glass icon of Google Site Search Box
      setTimeout(function(){
        if ($('.gsc-search-button-v2 > svg')[0]!== undefined) {
        $('.gsc-search-button-v2 > svg')[0].setAttribute("width","20");
        $('.gsc-search-button-v2 > svg')[0].setAttribute("height","20");
        }
      },1000);
    });
    
    
    $('.site-search-icon-control').click(function(){
      $('#site-search-icon').toggleClass('bi-search');
      $('#site-search-icon').toggleClass('bi-x-circle');
      $('.bi-x-circle ~ span').text('Close');
      $('.bi-search ~ span').text('Site Search');
    });


    /* 
     * 0.3 - Add aria-current="page"
     *
     * Add aria-current="page" to the menu item corresponding to the current page.
     * Uses JSON data generated by Jekyll to provide a crosswalk between the
     * Jekyll URLs and the LibGuides URLs. 
     *  --------------------------------------------------------------------------------------------
     */

    $(function () {
        var crosswalk;
        $.ajax({
            url: 'https://www.lib.miamioh.edu/crosswalk/jekyll-libguides.json',
            dataType: 'json',
            async: false,
            success: function (data) {
            crosswalk = data;
            },
        });

        /* find crosswalk entries that match this page url; add aria-current=page for each relevant item in nav */
        var pageUrl = window.location.href;
        var currPages = crosswalk.filter((obj) => {
            if (obj.lgurl == pageUrl) {
            return obj;
            }
        });
        currPages.forEach((currPage) => {
            $('a[href$="' + currPage.permalink + '"]')
            .first()
            .attr('aria-current', 'page');
        });
    });
</script>